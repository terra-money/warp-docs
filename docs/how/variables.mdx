---
sidebar_position: 4
---
# Variables 

use cosmwasm_schema::cw_serde;
use cosmwasm_std::{Decimal256, QueryRequest, Uint256};

use super::condition::{DecimalFnOp, IntFnOp, NumExprOp, NumValue};

#[cw_serde]
pub enum VariableKind {
    String,
    Uint,
    Int,
    Decimal,
    Timestamp,
    Bool,
    Amount,
    Asset,
}

#[cw_serde]
pub enum VariableValue {
    Static(String),
    Query(QueryExpr),
    External(ExternalExpr),
}

#[cw_serde]
pub struct ExternalExpr {
    pub url: String, // rest stuff for URL request:
    pub method: Option<Method>, 
    pub headers: Option<Vec<String>>,
    pub body: Option<String>,
    pub selector: String, // selecting within the returned json
}

#[cw_serde]
pub enum Method { // rest stuff
    Get,
    Post,
    Put,
    Patch,
    Delete,
}

#[cw_serde]
pub struct QueryExpr {
    pub selector: String,
    pub query: QueryRequest<String>,
}

#[cw_serde]
pub enum ExprOp {
    Add,
    Sub,
    Div,
    Mul,
    Mod,
}

#[cw_serde]
pub enum FnOp {
    Abs,
    Neg,
    Floor,
    Sqrt,
    Ceil,
}

#[cw_serde]
pub enum UpdateFnValue { //you can update using an expression to loop things
    Uint(NumValue<Uint256, NumExprOp, IntFnOp>),
    Int(NumValue<i128, NumExprOp, IntFnOp>),
    Decimal(NumValue<Decimal256, NumExprOp, DecimalFnOp>),
    Timestamp(NumValue<i128, NumExprOp, IntFnOp>),
    BlockHeight(NumValue<i128, NumExprOp, IntFnOp>), // num value can reference a variable, or an expression which can be a query
    Bool(String), //ref
}

#[cw_serde]
pub struct UpdateFn { // specify when you create the job
    pub on_success: Option<UpdateFnValue>,
    pub on_error: Option<UpdateFnValue>,
}

// Variable is specified as a reference value (string) in form of $warp.variable.{name}
// - variables are supplied along with the input (msg, query, template)
#[cw_serde]
pub enum Variable {
    Static(StaticVariable),
    External(ExternalVariable),
    Query(QueryVariable),
}

#[cw_serde]
pub struct StaticVariable {
    pub kind: VariableKind,
    pub name: String,
    pub value: String,
    pub update_fn: Option<UpdateFn>,
}

#[cw_serde] //get btc blockheight, succeeds, reinitialize (get variable again), or perform operator. 

pub struct ExternalVariable { // from an api, 
    pub kind: VariableKind,
    pub name: String,
    pub init_fn: ExternalExpr, //getting the external reference
    pub reinitialize: bool, //yes/no
    pub value: Option<String>, //none if uninitialized
    pub update_fn: Option<UpdateFn>, //updates without reinitializing externally
}


#[cw_serde]
pub struct QueryVariable {
    pub kind: VariableKind,
    pub name: String,
    pub init_fn: QueryExpr,
    pub reinitialize: bool,
    pub value: Option<String>, //none if uninitialized
    pub update_fn: Option<UpdateFn>,
}
